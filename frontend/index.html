<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Termo's Pet - Galeria</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <img src="./assets/Logo.png" alt="Logo" id="logo" />
  </header>

  <main>
    <section id="animal-list">
      <h2>Animais Dispon√≠veis</h2>
      <div id="galeria-geral"></div>
    </section>
    <aside id="info">
      <h2 id="user"> usuario</h2>
      <p>Bem-vindo ao Termo's Pet, um sistema dedicado a conectar animais que precisam de um lar amoroso com pessoas dispostas a adot√°-los. Nosso objetivo √© facilitar o processo de ado√ß√£o, promovendo o bem-estar animal e ajudando a encontrar lares permanentes para nossos amigos de quatro patas.</p>
      <p>Navegue pela nossa galeria de animais dispon√≠veis para ado√ß√£o. Cada animal possui uma ficha detalhada com informa√ß√µes sobre sua personalidade, necessidades especiais e fotos ador√°veis. Se voc√™ encontrar um companheiro que toque seu cora√ß√£o, entre em contato conosco para iniciar o processo de ado√ß√£o.</p>
      <p>Agradecemos seu interesse em adotar e contribuir para uma causa t√£o nobre. Juntos, podemos fazer a diferen√ßa na vida desses animais!</p>

    </aside>
  </main>

  <footer>
    <p>üê∂ Sistema de Ado√ß√£o - TERMO</p>
  </footer>

  <script>
    // ---------- utilit√°rios ----------
    function normalizeStr(str) {
      return String(str || '')
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '') // remove acentos
        .toLowerCase()
        .trim();
    }

    const KEYWORDS = {
      mamiferos: ['cachorro','cao','cachorra','gato','gatinho','hamster','coelho','cavalo','vaca','porco','rato','furao','fur√£o','leao','le√£o','fur√£o'],
      aves: ['ave','passarinho','passaro', 'p√°ssaro','papagaio','canario','can√°rio','periquito','galinha','pato','galo','corvo','tucano','calopsita','calopsita','pardal'],
      repteis: ['reptil','jacare','jacar√©','crocodilo','cobra','serpente','tartaruga','lagarto','iguana','iguana'],
      anfibios: ['anfibio','sapo','ra','r√£','salamandra','perereca','r√£'],
      peixes: ['peixe','betta','carpa','goldfish','tilapia','til√°pia','guppy','tetra']
    };

    function classificarEspecie(especieRaw) {
      const s = normalizeStr(especieRaw);
      for (const [grupo, palavras] of Object.entries(KEYWORDS)) {
        for (const p of palavras) {
          if (s === p || s.includes(p)) return grupo;
        }
      }
      return 'outros';
    }

    // ---------- renderiza√ß√£o de cards ----------
    function criarCard(animal) {
      const genero = Number(animal.genero);
      const emojiGenero = genero === 0 ? '‚ôÇÔ∏è' : '‚ôÄÔ∏è';
      const textoGenero = genero === 0 ? 'Macho' : 'F√™mea';

      const div = document.createElement('div');
      div.className = 'animal';
      div.innerHTML = `
        <img src="http://localhost:3000/animais/${animal.id}/foto" alt="Foto de ${animal.nome}" onerror="this.src='./assets/fallback.png'"/>
        <div class="animal-info">
          <h3>
            <span class="nome-genero">${animal.nome} <span title="${textoGenero}" class="emoji">${emojiGenero}</span></span>
          </h3>
          <p>${animal.descricao || ''}</p>
        </div>
      `;
      return div;
    }

    // ---------- montar carross√©is por grupo ----------
    async function carregarEExibirAnimais() {
      try {
        const resp = await fetch('http://localhost:3000/animais');
        if (!resp.ok) throw new Error('Erro ao buscar animais');
        const animais = await resp.json();

        const grupos = { mamiferos: [], aves: [], repteis: [], anfibios: [], peixes: [], outros: [] };
        animais.forEach(a => {
          const grupo = classificarEspecie(a.especie);
          grupos[grupo].push(a);
        });

        const container = document.getElementById('galeria-geral');
        container.innerHTML = '';

        const order = ['mamiferos','aves','repteis','anfibios','peixes','outros'];
        const titles = { mamiferos: 'Mam√≠feros', aves: 'Aves', repteis: 'R√©pteis', anfibios: 'Anf√≠bios', peixes: 'Peixes', outros: 'Outros' };

        order.forEach(key => {
          if (grupos[key].length === 0) return;

          const section = document.createElement('section');
          section.className = 'carrossel-section';
          section.innerHTML = `
            <div class="section-header">
              <h3 class="section-title">${titles[key]}</h3>
              <div class="controls">
                <button class="btn-left" aria-label="Voltar">‚Äπ</button>
                <button class="btn-right" aria-label="Avan√ßar">‚Ä∫</button>
              </div>
            </div>
            <div class="carrossel-container">
              <div class="galeria" id="galeria-${key}"></div>
            </div>
          `;
          container.appendChild(section);

          const gal = section.querySelector(`#galeria-${key}`);
          grupos[key].forEach(animal => gal.appendChild(criarCard(animal)));

          // bot√µes de navega√ß√£o
          const containerCarrossel = section.querySelector('.carrossel-container');
          const btnLeft = section.querySelector('.btn-left');
          const btnRight = section.querySelector('.btn-right');

          btnLeft.addEventListener('click', () => containerCarrossel.scrollBy({ left: -420, behavior: 'smooth' }));
          btnRight.addEventListener('click', () => containerCarrossel.scrollBy({ left: 420, behavior: 'smooth' }));
        });

      } catch (err) {
        console.error(err);
        document.getElementById('galeria-geral').innerText = 'Erro ao carregar animais.';
      }
    }

    // inicia
    carregarEExibirAnimais();
  </script>
</body>
</html>
